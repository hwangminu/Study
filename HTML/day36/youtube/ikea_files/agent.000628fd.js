!function(){"use strict";var e,t,n,i="https://igift.ingka.com/graphql",o="https://808494b3c14d437d8ac80a6023979d28@o123489.ingest.sentry.io/5294297",r=void 0===(e=(o.match(/:\/\/(.*?)@/)||[])[1])?"":e,a=void 0===(t=(o.match(/\/([^\/]+)\/?$/)||[])[1])?"":t,s="ikea.sentry.register",u=/\/[a-z0-9]{2}\/[a-z0-9]{2}\/gift-registry\/agent\//,c=function(){var e,t=null!==(e=window.location.pathname.match(/\w{2}/g))&&void 0!==e?e:[],n=t[0],i=t[1];return{country:null!=n?n:"",language:null!=i?i:""}},d=function(e,t,n,i){void 0===n&&(n=30);var o=function(e){if(e&&2===e.length)return"/"+e+"/";var t=c().country;return t&&2===t.length?"/"+t+"/":"/"}(i),r="expires="+function(e){var t=new Date;return t.setTime(t.getTime()+24*e*60*60*1e3),t.toUTCString()}(n);document.cookie=e+"="+t+";"+r+";domain="+(window.location.origin.includes("ikea.com")?".ikea.com":".ikeadt.com")+";path="+o};!function(e){e[e.strictlyNecessaryCookies=1]="strictlyNecessaryCookies",e[e.performanceCookies=2]="performanceCookies",e[e.functionalCookies=3]="functionalCookies",e[e.targetingCookies=4]="targetingCookies",e[e.socialMediaCookies=5]="socialMediaCookies",e.videoCookies="VID1"}(n||(n={}));var l=function(e){var t,n;return null===(n=null===(t=window.ikea)||void 0===t?void 0:t.cookieConsent)||void 0===n?void 0:n.hasConsent(e)},y=function(){return Boolean(window.ikea.sentry&&r&&a&&l(n.performanceCookies))},g="igift-agent@1.8.17",v=function(e,t){y()&&window.ikea.sentry.store(e,a,r,s,g,1,t)},f=function(e,t){var i={event_category:"gift_registry",event_action:e,event_label:t};l(n.performanceCookies)&&"function"==typeof window.sendEvent&&window.sendEvent(i)},m=window.location.pathname.match(/\/(\w{2})\/(\w{2})\//)||[],R=m[1],w=m[2];function p(e){var t=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),n=decodeURIComponent(window.atob(t).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(n)}var I=function(e){var t,n;if(!e)return"";var i=p(e);return null!==(n=null!==(t=i["https://accounts.ikea.com/partyUId"])&&void 0!==t?t:i.sub)&&void 0!==n?n:""},h=function(e){var t;if(!e)return!1;var n=null!==(t=p(e)["https://accounts.ikea.com/loyaltyPrograms"])&&void 0!==t?t:[];return Array.isArray(n)&&n.includes("IKEA_FAMILY")},_=function(e){var t;return e?(null!==(t=p(e)["https://accounts.ikea.com/retailUnit"])&&void 0!==t?t:"").toLowerCase():""},k=function(e){var t=e.auth,n=e.guest;return t&&t.value?{uid:I(t.value),token:t.value,guest:!1,isFamilyMember:h(t.value),retailUnit:_(t.value)}:{uid:I(null==n?void 0:n.value),token:(null==n?void 0:n.value)||"",guest:!0,isFamilyMember:!1,retailUnit:_(null==n?void 0:n.value)}},T=function(){return new Promise((function(e,t){window.ikea&&window.ikea.authentication?window.ikea.authentication.getTokens((function(n,i){n&&t(n),e(i)})):t("ikea.authentication is missing")}))},b=function(e,t){return T().then((function(n){var o=k(n).token;return function(e){var t=e.endpoint,n=e.token,i=e.query,o=e.variables;return fetch(t,{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json",Authorization:"Bearer "+n,"Preferred-Locale":w.toLowerCase()+"-"+R.toUpperCase()},body:JSON.stringify({query:i,variables:o})}).then((function(e){return e.status>=400?e.json().catch((function(){return""})).then((function(n){return Promise.reject(new Error(e.statusText+" ("+e.status+") when contacting "+t+". Response: "+JSON.stringify(n)))})):e}))}({query:e,variables:t,endpoint:i,token:o}).catch((function(e){return v(e,{context:"callAPI() catch"}),Promise.reject(e)})).then((function(e){return e.json()})).then((function(e){if(e.errors){var t="INTERNAL_ERROR",n=e.errors;e.errors&&e.errors[0]&&e.errors[0].extensions?(t=e.errors[0].extensions.code,n=e.errors[0].extensions.data):v("No error code found!",{context:"callAPI() response"});var o=new Error("Got "+t+" when contacting "+i+". Error data: "+JSON.stringify(n));return Promise.reject(o)}return e}))}))};var E="disabled",C="igift-agent",S="GIFT_REGISTRY/",A=S+"ADD_TO_GIFT_REGISTRY",G=A+"_FAILURE",F=S+"REMOVE_FROM_GIFT_REGISTRY",N=F+"_FAILURE",O="ikeaCookieConsent/changed";function P(){return l(n.strictlyNecessaryCookies)}function Y(e){return T().then((function(t){var n=k(t),i=n.guest,o=n.uid,r=n.retailUnit;!i&&o&&P()?d(C,e,7,r):function(e,t){d(e,"",0,t)}(C,r)}))}function x(e){return b("\n    query activeRegistry {\n      activeRegistry {\n        __typename\n      }\n    }\n  ").then((function(t){var n=t.data.activeRegistry.__typename;if("ActiveRegistryPayload"===n)Y(e);else if("NotFoundError"===n)Y(E);else{if("SuspendedRegistryError"!==n)throw new Error("Unhandled __typename "+n);Y(E)}return n})).catch((function(e){return Y(E),v(e,{context:"hasRegistry() catch"}),"RegistryLoadError"}))}var U=window.ikea.pubsub.publish,M=function(e){var t,n,i;U("GIFT_REGISTRY/ADD_TO_GIFT_REGISTRY_INITIATE",{payload:e}),(t=e.registryId,n=e.itemNo,i=Number(e.quantity),void 0===t&&(t=null),void 0===i&&(i=1),b("\n      mutation addRegistryItems($input: AddRegistryItemsInput!) {\n        addRegistryItems(input: $input) {\n          __typename\n          ... on AddRegistryItemsPayload {\n            registry {\n              id\n              title\n            }\n          }\n        }\n      }\n    ",{input:{registryId:t,items:[{itemNo:n,quantity:i}]}})).then((function(t){var n=t.data;"AddRegistryItemsPayload"===n.addRegistryItems.__typename?U("GIFT_REGISTRY/ADD_TO_GIFT_REGISTRY_SUCCESS",{title:n.addRegistryItems.registry.title,registryId:n.addRegistryItems.registry.id,payload:e}):(U(G,{payload:e,error:n.addRegistryItems.__typename}),T().then((function(e){return x(k(e).uid).then((function(e){"ActiveRegistryPayload"===e?$():function(e){void 0===e&&(e={}),U("GIFT_REGISTRY/INACTIVE",e)}()}))}))),f("registry_add_item","source: "+e.source)})).catch((function(t){v(t,{context:A+" catch"}),U(G,{payload:e})}))},j=function(e){U("GIFT_REGISTRY/REMOVE_FROM_GIFT_REGISTRY_INITIATE",{payload:e}),e.registryId?q(e):b("\n    query activeRegistry {\n      activeRegistry {\n        __typename\n        ... on ActiveRegistryPayload {\n          registry {\n            id\n          }\n        }\n      }\n    }\n  ").then((function(t){var n=t.data;"ActiveRegistryPayload"===n.activeRegistry.__typename?(e.registryId=n.activeRegistry.registry.id,q(e)):U(N,{payload:e})})).catch((function(t){v(t,{context:F+" catch"}),U(N,{payload:e})}))};function q(e){var t,n;(t=e.registryId,n=e.itemNo,b("\n      mutation removeRegistryItems($input: RemoveRegistryItemsInput!) {\n        removeRegistryItems(input: $input) {\n          __typename\n          ... on RemoveRegistryItemsPayload {\n            registry {\n              id\n              title\n            }\n          }\n        }\n      }\n    ",{input:{registryId:t,itemNos:[n]}})).then((function(t){var n=t.data;"RemoveRegistryItemsPayload"===n.removeRegistryItems.__typename?U("GIFT_REGISTRY/REMOVE_FROM_GIFT_REGISTRY_SUCCESS",{title:n.removeRegistryItems.registry.title,registryId:n.removeRegistryItems.registry.id,payload:e}):U(N,{payload:e,error:n.removeRegistryItems.__typename}),f("registry_remove_item","source: "+e.source)})).catch((function(t){v(t,{context:"removeRegistryItem() catch"}),U(N,{payload:e})}))}var D,L,V=function(e,t){var n;return(null!==(n=window.ikea.pubsub.subscriptions.get(e))&&void 0!==n?n:[]).some((function(e){return e.toString()===t}))},$=function(e){void 0===e&&(e={}),V(A,M.toString())||window.ikea.pubsub.subscribe(A,M),V(F,j.toString())||window.ikea.pubsub.subscribe(F,j),U("GIFT_REGISTRY/ACTIVE",e)},z=c().country,B="au,be,cz,de,es,fi,gb,hr,hu,ie,it,jp,kr,nl,no,pt,ro,rs,se,si,sk".split(",").includes(z);function J(){"www.ikea.com"===window.location.hostname&&P()&&(y()&&window.ikea.sentry.register(a,r,s,g,1,[u]),T().then((function(e){var t=k(e),n=t.guest,i=t.uid,o=t.isFamilyMember,r=function(e){for(var t=e+"=",n=document.cookie.split(";"),i=0;i<n.length;i++){for(var o=n[i];" "===o.charAt(0);)o=o.substring(1);if(0===o.indexOf(t))return o.substring(t.length,o.length)}return null}(C),a=!!B&&Boolean(!n&&!o),s=Boolean(r!==E&&!n&&i&&!a);if(r===i)$();else{if(s)return x(i).then((function(e){"ActiveRegistryPayload"===e&&$()}));Y(E)}})).catch((function(e){v(e,{context:"getTokens() catch"})})),window.ikea=window.ikea||{},window.ikea.giftRegistry=window.ikea.giftRegistry||{},0===Object.keys(window.ikea.giftRegistry).length&&Object.assign(window.ikea.giftRegistry,{enable:function(){T().then((function(e){Y(k(e).uid),$()}))},disable:function(){Y(E)}}))}var K=null===(L=null===(D=null===window||void 0===window?void 0:window.ikea)||void 0===D?void 0:D.cookieConsent)||void 0===L?void 0:L.statusStringified,H=function(){var e,t,n,i;(null===(t=null===(e=window.ikea)||void 0===e?void 0:e.cookieConsent)||void 0===t?void 0:t.statusStringified)!==K&&(K=null===(i=null===(n=window.ikea)||void 0===n?void 0:n.cookieConsent)||void 0===i?void 0:i.statusStringified,J())};V(O,H.toString())||window.ikea.pubsub.subscribe(O,H),J()}();

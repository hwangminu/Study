(function(){"use strict";function _(l){if(!l)return{};let t={};try{t=window.structuredClone?.(l)||JSON.parse(JSON.stringify(l))}catch(e){e instanceof DOMException&&(t=JSON.parse(JSON.stringify(l)))}return t}const f={pra_name:"pra_name",pra_no:"pra_no",pa_name:"pa_name",pa_no:"pa_no",hfb_name:"hfb_name",hfb_no:"hfb_no",id:"product_ids",name:"product_names",price:"price",series:"product_series",type:"product_type",variant:"product_variant",vat:"product_vats",category:"category",category_local:"category_local"},b=["price","product_prices","product_vats","tax"];class C{constructor(t){this.data=_(t)}getData(t){return this.data[t]===void 0||this.data[t]===""?null:Array.isArray(this.data[t])?this._clean(t,this.data[t][0]):this._clean(t,this.data[t])}_clean(t,e){return b.includes(t)&&Number(e)||e}getPipData(t=null){let e={};for(let i in f)(!t||t.includes(f[i]))&&this.getData(f[i])&&(e[i]=this.getData(f[i]));return e}}function E(l){let t=new C(l);return new Proxy(t,{get(e,i,n){return i==="pathname"?window.location.pathname:i==="country"?window.location.pathname.split("/")[1]:i==="language"?window.location.pathname.split("/")[2]:i==="site_level_1"?window.location.pathname.split("/")[3]:i==="site_level_2"?window.location.pathname.split("/")[4]:i==="getPipData"?t.getPipData.bind(t):i==="pip_data"?t.getPipData():t.getData(i)},set(e,i,n){return e.data[i]=n,!0}})}const c={PAGE_VIEW:"pageView",ADD_TO_CART:"addToCart",ADD_TO_WISHLIST:"addToWishlist",STOCKCHECK:"stockcheck",SEARCH:"search",WISHLIST:"wishlist",VIEW_ITEM:"viewItem",VIEW_CART:"viewCart",VIEW_CATEGORY:"viewCategory",PROFILE_SIGNUP:"profileSignup",PROFILE_LOGIN:"profileLogin",PROFILE_LOGOUT:"profileLogout",PROFILE_UPDATE:"profileUpdate",PROFILE_VIEW:"profileView",PURCHASE:"purchase"},v={[c.ADD_TO_CART]:"add_to_cart",[c.ADD_TO_WISHLIST]:"ecommerce",[c.STOCKCHECK]:"pip_page_actions",[c.SEARCH]:"search",[c.WISHLIST]:"ecommerce",[c.VIEW_ITEM]:"view_item",[c.VIEW_CART]:"checkout_progress",[c.PURCHASE]:"purchase"},I={[c.ADD_TO_CART]:["trackAddToCart","getAddToCartInfo"],[c.ADD_TO_WISHLIST]:["trackAddToWishlist","getAddToWishListInfo"],[c.STOCKCHECK]:["trackStockCheck","getStockCheckInfo"],[c.SEARCH]:["trackSearch","getSearchInfo"],[c.WISHLIST]:["trackWishlist","getWishlistInfo"],[c.VIEW_ITEM]:["trackViewItem","getViewItemInfo"],[c.VIEW_CART]:["trackViewCart","getViewCartInfo"],[c.PURCHASE]:["trackPurchase","getPurchaseInfo"]};class y{constructor(t,e,i,n=window.utag_data){this._trackMethodLookup=I,this._events=v,this.name=t,this.id=e,this.url=i,this.b=new E(n),this._MNOErrorMsg="Pixel class tracking methods need to be overridden in Child class"}send(t){let{path:e="",queryParams:i}=t;new Image().src=`${this.url}${e}?${i.toString()}`}track(t,...e){window.addEventListener(this._events[t],i=>{let[n,a]=this._trackMethodLookup[t],[r,s]=this[a](i.detail);r?.length&&(r=r.map(({vat:o,price:d,quantity:u,...p})=>(o=Number(o)||null,d=Number(d)||null,u=Number(u)||null,{vat:o,price:d,quantity:u,...p}))),s&&this[n](r,i,...e)})}getAddToCartInfo(t){let{event_label:e,params:i={}}=t,n=_(i?.items||[]),a=!0;return e==="pip"&&(n[0]={...n[0],...this.b.getPipData()}),e==="services_cart"&&(a=!1),[n,a]}getAddToWishListInfo(t){let e=[],i=!1;if(t?.event_action==="add_to_wishlist"){i=!0;let n=t?.custom?.item_number_event?.split(","),a=t?.custom?.product_quantity?.split(",");n.forEach((r,s)=>{let o={id:r};a?.[s]&&(o.quantity=Number(a[s])),e.push(o)}),t.event_label==="pip"&&(e[0]={...e[0],...this.b.getPipData()})}return[e,i]}getSearchInfo(t){let e=[],i=!1;return t?.event_action==="hard_search"&&(i=!0,e.push(t?.event_label)),[e,i]}getViewItemInfo(t){let e=_(t?.params?.items||[]);const i=t?.custom?.stock_check_store_id;let n=!0;return e[0]={...e[0],quantity:1,...this.b.getPipData(),store_id:i},[e,n]}getStockCheckInfo(t){let{event_action:e,event_label:i,custom:n}=t||{},a=[],r=!1;return(e==="change_store_click"&&i==="change_store_link"||e==="stock_check_click"&&i==="stock check")&&(r=!0,a=n?.item_number_event?.split(",").map(s=>({id:s})),this.b.site_level_1==="p"&&(a[0]={...a[0],...this.b.getPipData()})),[a,r]}getWishlistInfo(t){let e=[],i=!1;if(t?.event_action==="view_list"){i=!0,e=_(t?.params?.items||[]);let n=t?.custom?.item_number_event?.split(",")||[],a=t?.custom?.product_quantity?.split(",")||[];n.forEach((r,s)=>{e.push({id:r,quantity:a[s]})})}return[e,i]}getViewCartInfo(t){let e=[],i=!1;return t?.event_label==="cart_view"&&(i=!0,e=_(t?.params?.items||[])),[e,i]}getPurchaseInfo(t){let e=[],i=!1;return t?.event_label==="success"&&(i=!0,e=_(t?.params?.items||[])),[e,i]}trackLocal(){let t=`_${this.name}Local`,e=`${t}Loaded`;if(window[t])window[t](this);else{let i=()=>{window[t]?.(this),window.removeEventListener(e,i)};window.addEventListener(e,i)}}trackAddToCart(){throw Error(this._MNOErrorMsg)}trackAddToWishlist(){throw Error(this._MNOErrorMsg)}trackStockCheck(){throw Error(this._MNOErrorMsg)}trackWishlist(){throw Error(this._MNOErrorMsg)}trackViewItem(){throw Error(this._MNOErrorMsg)}trackSearch(){throw Error(this._MNOErrorMsg)}trackViewCart(){throw Error(this._MNOErrorMsg)}trackPurchase(){throw Error(this._MNOErrorMsg)}}const T={PageView:c.PAGE_VIEW,AddToCart:c.ADD_TO_CART,AddToWishlist:c.ADD_TO_WISHLIST,Search:c.SEARCH,ViewContent:c.VIEW_ITEM,CompleteRegistration:c.PROFILE_SIGNUP,Purchase:c.PURCHASE},A=["PageView","Search","AddToCart","AddToWishlist","ViewContent","InitiateCheckout","AddPaymentInfo","Purchase","CompleteRegistration","Contact","CustomizeProduct","Donate","FindLocation","Lead","Schedule","StartTrial","SubmitApplication","Subscribe"],S={riig:"3465423686912116",roig:"888079142586440"};function P(l,t){const e="metaEventIdStorage",i=t??l,n=window[e]=window[e]||{};if(n[i])return n[i];let a=`${new Date().getTime()}.${Math.floor(Math.random()*1e8)}`;return a+=`.${Math.floor(Math.random()*(t||123456789)*1e7)}`,n[i]=a,a}const D=function(l){const t=[{eventName:"Complete_Appointment_Kitchen",defaultPath:/.*\/appointment\/kitchen/,defaultCategory:"self_serve_actions",defaultAction:"appointment",defaultLabel:/^complete_.+_kitchen_appointment.*$/,marketConditions:{at:{path:/.*\/customer-service\/services\/kitchen-planning\/kuechenplanungstermin-pub718a466d/,category:"user_actions",action:"other_forms",label:/^booking-tool-.+ | 3 | booking-complete |.*$/},de:{path:/.*\/local-apps\/kuechenplanungsservice/,category:"local_tracking_user_actions",action:/^signup_completed_kitchen_.*$/,label:"newsletter_refusal"},es:{path:/.*\/customer-service\/services\/asesores-especialistas-form-pubedd351a0/,category:"local_tracking_filter",action:"Asesor",label:/^ConfirmaciÃ³n_.+_cocinas.*$/},in:{path:/.*\/customer-service\/need-help-planning-a-kitchen-book-an-appointment-now-pub68c33a30/,category:"pub_page_actions",action:"cta_click",label:"kitchensubmit"},pl:{path:/.*\/customer-service\/services\/kitchen-planning/,category:"local_tracking_kitchen_planning",action:"buy_plan"}}}],e=(i,n,a,r)=>{window.addEventListener(n,({detail:s={},timeStamp:o})=>{const{event_action:d,event_label:u}=s;d?.match(a)&&u?.match(r)&&l.send(i,{},o)})};t.forEach(i=>{const{eventName:n,defaultPath:a,marketConditions:{[l.b.country]:r}}=i;if(r&&location.pathname.match(r.path)){const{category:s,action:o,label:d}=r;e(n,s,o,d)}else if(location.pathname.match(a)){const{defaultCategory:s,defaultAction:o,defaultLabel:d}=i;e(n,s,o,d)}})};function L(l){let t=document.cookie.split("; ").find(e=>e?.startsWith(`${l}=`))?.split(/=(.+)/s,2)[1];try{t&&(t=decodeURIComponent(t))}catch(e){console.error(`Failed to decode cookie "${l}":`,e),t=null}return t}function M(l,t,e,{domain:i,path:n="/",secure:a=!0,samesite:r="lax"}={}){if(!l)return console.error("Failed to set cookie. A cookie must at least have a name.");t=encodeURIComponent(typeof t=="string"?t:JSON.stringify(t));let s=`${l}=${t};path=${n};samesite=${r}`;if(typeof e=="number"){if(e<=0)s+=`;expires=${new Date(null).toUTCString()}`;else if(e>0){let o=new Date;o.setDate(o.getDate()+e),s+=`;expires=${o.toUTCString()}`}}i&&(s+=`;domain=${i}`),a&&(s+=";secure"),document.cookie=s}const w=function(l=[]){return l.length?l.reduce((t,{quantity:e=1})=>Number(t)+Number(e),0):1},O=function(l=[]){const t=l?.reduce((e,{price:i=0,quantity:n=1})=>Number(e)+Number(i)*Number(n),0)?.toFixed(2);return!t||t==="NaN"?0:Number(t)};class N extends y{constructor(t,e,{cc:i,lang:n,curr:a,tagType:r,useCAPI:s,b:o=window.utag_data,ep:d="https://www.facebook.com/",epPath:u="tr",cDomain:p="ikea.com",cExpiry:m=30,name:g="fb"}={}){if(!t)throw new Error('MetaPixel: Failed to initialize pixel. Argument "pixelId" is required');if(!e)throw new Error('MetaPixel: Failed to initialize pixel. Argument "marketType" is required');super(g,t,d,o),this.marketType=e,this.country=i||this.b.country,this.language=n||this.b.language,this.currency=a||this.b.currency,this.tagType=r||"script",this.useCAPI=s||!1,this.fbp=this._fbp,this.fbclid=this._fbclid,this._cDomain=p,this._cExpiry=m,this._scriptURL="https://connect.facebook.net/en_US/fbevents.js",this._endpoint=d,this._endpointPath=u,this.tagType==="script"&&(window.fbq||this._loadScript(),this.fbq=window.fbq,this.fbq("init",this.id))}get _fbp(){const t={version:"fb",subdomainIndex:"1",creationTime:Date.now()},e=L("_fbp")||`${t.version}.${t.subdomainIndex}.${t.creationTime}.${Math.round(2147483647*Math.random())}`;return M("_fbp",e,this._cExpiry,{domain:this._cDomain}),e}get _fbclid(){const t=new URLSearchParams(window.location.search).get("fbclid");return t?`fb.1.${Date.now()}.${t}`:void 0}_getTrackType(t){return A.includes(t)?"trackSingle":"trackSingleCustom"}_getContentsArr(t=[]){return t.map(({id:e,price:i,quantity:n}={})=>{const a={id:e,quantity:n||1};return i&&(a.item_price=i),a})}_loadScript(){const t=window.fbq=function(){t.callMethod?t.callMethod.apply(t,arguments):t.queue.push(arguments)};window._fbq||(window._fbq=t,t.push=t,t.loaded=!0,t.version="2.0",t.queue=[]);const e=document.createElement("script");e.async=!0,e.src=this._scriptURL;const i=document.getElementsByTagName("script")[0];i.parentNode.insertBefore(e,i)}_sendScriptEvent(t,e,i){const n=this._getTrackType(t);this.fbq(n,this.id,t,e,{eventID:i})}_sendImgEvent(t,e,i){const n={id:this.id,ev:t,dl:encodeURIComponent(window.location.origin+window.location.pathname),ts:new Date().getTime(),fbp:this.fbp};i&&(n.eid=i),this.fbclid&&(n.fbclid=this.fbclid);for(const[a,r]of Object.entries(e))r&&(n[`cd[${a}]`]=typeof r!="string"?JSON.stringify(r):r);super.send({queryParams:new URLSearchParams(n),path:this._endpointPath})}send(t,e={},i){const n=this.useCAPI?P(T[t],i):null;this.tagType==="script"&&typeof this.fbq=="function"?this._sendScriptEvent(t,e,n):this._sendImgEvent(t,e,n)}trackEventCB(t,e){window.addEventListener(t,({detail:i={},timeStamp:n})=>{let{metaEvent:a,payload:r={}}=e(i)||{};a&&this.send(a,r,n)})}getEventPayload({items:t=[],value:e,currency:i,transaction_id:n,num_items:a,event_action:r,event_label:s}={}){const o={};if(this.marketType==="riig"&&(o.country=this.country,o.language=this.language),t?.length&&(o.contents=this._getContentsArr(t),o.currency=i||this.currency,o.value=(e??Number(e))||O(t)||void 0,o.content_type="product"),r==="view_item"||s==="pip"){const[{series:d,variant:u,name:p,category:m,category_local:g}={}]=t;o.content_name=(d&&u?`${d} ${u}`:p)?.toLowerCase(),o.content_category=`${g?.toLowerCase()} - ${m}`}else s==="plp"&&this.b.page_category_level==="chapter"?o.content_category=`${this.b.site_level_2}`:r==="hard_search"&&(o.currency=i||this.currency,o.search_string=s);return a&&(o.num_items=a),n&&(o.order_id=n),o}trackPageView(){this.send("PageView",this.getEventPayload())}trackSearch(t,{detail:{event_action:e,event_label:i},timeStamp:n}){const a=this.getEventPayload({event_action:e,event_label:i});this.send("Search",a,n)}trackAddToWishlist(t,{detail:{event_label:e},timeStamp:i}){const n={items:t,event_label:e},a=this.getEventPayload(n);this.send("AddToWishlist",a,i)}trackAddToCart(t,{detail:e,timeStamp:i}){const{event_label:n,custom:{cart_value_local:a}={}}=e,r={items:t,event_label:n,value:a},s=this.getEventPayload(r);this.send("AddToCart",s,i)}trackViewItem(t,{timeStamp:e}){const i=this.getEventPayload({items:t,event_action:"view_item"});this.send("ViewContent",i,e)}trackInitiateCheckout(){this.trackEventCB("begin_checkout",({detail:t={}})=>{const{params:{items:e},custom:{cart_value:i,cart_quantity:n}}=t,a={items:e,value:i,num_items:n||w(e)},r=this.getEventPayload(a);return{metaEvent:"InitiateCheckout",payload:r}})}trackPurchase(t,{detail:e,timeStamp:i}){const{params:{currency:n,value:a,transaction_id:r},custom:{cart_quantity:s}}=e,o={items:t,value:a,transaction_id:r,currency:n,num_items:s||w(t)},d=this.getEventPayload(o);this.send("Purchase",d,i)}trackAppointments(){D(this)}}const k="riig",R="kr",V="KRW",W=S[k],{lang:$,tagType:q,useCAPI:H,ep:U,epPath:x,cDomain:F,cExpiry:G,name:K}=typeof _META_CONFIG<"u"?_META_CONFIG:{},h=new N(W,k,{cc:R,curr:V,tagType:q,useCAPI:H,lang:$,ep:U,epPath:x,cDomain:F,cExpiry:G,name:K});h.trackPageView(),h.track(c.SEARCH),h.track(c.ADD_TO_CART),h.track(c.ADD_TO_WISHLIST),h.b.site_level_1==="p"?h.track(c.VIEW_ITEM):window.Checkout&&(h.trackInitiateCheckout(),h.track(c.PURCHASE)),h.trackLocal(),h.trackAppointments()})();
